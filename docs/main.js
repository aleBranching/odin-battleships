(()=>{"use strict";function e(e){let o=0;const t=e;return{isSunk:()=>o>=t,hit:()=>{o+=1},_length:t,placed:!1,coordinates:void 0}}function o(){const o=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],t=[null,e(4),e(3),e(3),e(2),e(2),e(2),e(1),e(1),e(1),e(1)],r=[],n=e=>{let o=0;return(t=>{for(let t=0;t<r.length;t++)r[t]===e&&o++})(),o<{1:4,2:3,3:2,4:1}[e]},l=()=>[Math.floor(10*Math.random()),Math.floor(10*Math.random())],a=()=>1===Math.floor(2*Math.random()),c=e=>{const[o,t]=l(),r=a();try{s(e,o,t,r)}catch(o){return c(e)}},s=(e,l,a,c)=>{if(l<0||a<0||l>10||a>10)throw new Error((e=>{console.error("can't place ship here or no more of these ships or ship too big")}));if(!n)throw new Error((e=>{console.error("can't put anymore of these ships")}));let s;if(!(()=>{const t=(()=>{const o=[];if(c){if(c){let t=l;for(let r=0;r<e;r++)if(o.push([t,a]),t++,t>10)throw new Error("Boat out of game!")}}else{let t=a;for(let r=0;r<e;r++)if(o.push([l,t]),t++,t>10)throw new Error("boat out of game!")}return o})();return!!(()=>{let e=!0;return t.forEach((t=>{const r=t[0],n=t[1];0!==o[n][r]&&(e=!1)})),e})()&&(s=[...t],!0)})()||!n(e))throw new Error("most likely ship is overlaping");{const n=(e=>{let o;for(let r=0;r<=10;r++)if(null!=t[r]&&t[r]._length===e&&!1===t[r].placed){o=r;break}return o})(e);t[n].placed=!0,r.push(e),t[n].coordinates=s,s.forEach((e=>{const t=e[0],r=e[1];o[r][t]=n}))}},i=[];return{placeShip:s,gameArena:o,receiveAttack:(e,r)=>{if(0!==o[r][e]){const n=o[r][e];return t[n].hit(),!0}return i.push([e,r]),!1},allShipsSunk:()=>{let e=0;for(let o=1;o<11;o++)t[o].isSunk()&&e++;return e>=10},missedShots:i,currentShipsOBJ:t,placeShipRandomly:c,positionAllShipsRandomlyTemplate:()=>{const e=[],o=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],t=[4,3,3,2,2,2,1,1,1,1];let r=-1;const n=()=>{try{const[c,s]=l(),i=a();return r+=1,10===r?void 0:(e.push(((e,o,t,r,n)=>{if(t<0||r<0||t>10||r>10)throw new Error((e=>{console.error("can't place ship here or no more of these ships or ship too big")}));let l;if((()=>{const a=(()=>{const e=[];if(n){if(n){let n=t;for(let t=0;t<o;t++)if(e.push([n,r]),n++,n>10)throw new Error("Boat out of game!")}}else{let n=r;for(let r=0;r<o;r++)if(e.push([t,n]),n++,n>10)throw new Error("boat out of game!")}return e})();return!!(()=>{let o=!0;return a.forEach((t=>{const r=t[0],n=t[1];0!==e[n][r]&&(o=!1)})),o})()&&(l=[...a],!0)})())return l.forEach((o=>{const t=o[0],r=o[1];e[r][t]=1})),{x:l[0][0],y:l[0][1],length:o,horizontally:n};throw new Error("most likely ship is overlaping")})(o,t[r],c,s,i)),n())}catch(e){return r-=1,n()}};return n(),[e,o]}}}const t=function(){const e=(e,o,t)=>document.querySelector(`.${e} .row[data-y="${t}"] .box[data-x="${o}"]`);return{renderExistingBoats:(o,t)=>{const r=([o,r])=>{e(t,o,r).style.backgroundColor="grey"};o.currentShipsOBJ.forEach((e=>{null==e||e.coordinates.forEach(r)}))},getBoxDOM:e,getXandY:e=>{const{x:o}=e.target.dataset,{y:t}=e.target.parentElement.dataset;return[o,t]},changeAllBoxesOfShip:(o,t,r)=>{const{coordinates:n}=r.currentShipsOBJ[o];n.forEach((o=>{const[r,n]=o;e(`${t}`,r,n).style.backgroundColor="red"}))},getBoxDOMsShipIndex:(e,o,t)=>e.gameArena[t][o],changeBoxColour:(o,t,r,n)=>{e(o,t,r).style.backgroundColor=n},toggleHovering:()=>{document.querySelector(".enemyArea").classList.toggle("hovering")},renderTemplateBoats:o=>{o.forEach(((t,r)=>{t.forEach(((t,n)=>{1===o[r][n]&&(e("positionArea",n,r).style.backgroundColor="grey")}))}))},resetTemplateColours:()=>{const o=(o,t)=>{e("positionArea",o,t).style.backgroundColor="white"};for(let e=0;e<10;e++)for(let t=0;t<10;t++)o(e,t)}}}(),r=document.querySelector("#randomise"),n=document.querySelector("#submit"),l=document.querySelector("#templateDialog");let a,c=[];r.addEventListener("click",(()=>{t.resetTemplateColours();const e=o(),[r,n]=e.positionAllShipsRandomlyTemplate();a=n,c=r,t.renderTemplateBoats(n)})),n.addEventListener("click",(()=>{l.close(),s(c)}));const s=()=>{const e=o(),r=o();((e,o)=>{for(let o=0;o<10;o++)e.placeShip(c[o].length,c[o].x,c[o].y,c[o].horizontally);o.placeShipRandomly(4),o.placeShipRandomly(3),o.placeShipRandomly(3),o.placeShipRandomly(2),o.placeShipRandomly(2),o.placeShipRandomly(2),o.placeShipRandomly(1),o.placeShipRandomly(1),o.placeShipRandomly(1),o.placeShipRandomly(1)})(e,r);let n=!0;t.renderExistingBoats(e,"playerArea");const l=e=>{const o=e.target,[l,a]=t.getXandY(e),c=t.getBoxDOMsShipIndex(r,l,a);if(!o.dataset.hit){if(o.dataset.hit=!0,s(),r.receiveAttack(l,a)){const e=r.currentShipsOBJ[c];o.style.backgroundColor="grey",e.isSunk()&&t.changeAllBoxesOfShip(c,"enemyArea",r),r.allShipsSunk()&&(alert("game Over"),n=!1)}else o.style.backgroundColor="rgb(201, 201, 178)";h()}},a=()=>{document.querySelectorAll(".enemyArea .row .box").forEach((e=>{e.addEventListener("click",l,{once:!0})}))},s=()=>{document.querySelectorAll(".enemyArea .row .box").forEach((e=>{e.removeEventListener("click",l)})),t.toggleHovering()},i=function(e){const o=[],t=()=>{const e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());return void 0!==o.find((o=>o[0]===e&&o[1]===r))?t():[e,r]};return{attack:()=>{const[r,n]=t(),l=e.receiveAttack(r,n);return o.push([r,n]),[l,r,n]}}}(e),h=()=>{if(!n)return;const[o,r,l]=i.attack(),c=t.getBoxDOM("playerArea",r,l);if(o){const o=t.getBoxDOMsShipIndex(e,r,l),n=e.currentShipsOBJ[o];c.style.backgroundColor="pink",a(),n.isSunk()&&t.changeAllBoxesOfShip(o,"playerArea",e)}else c.style.backgroundColor="rgb(201, 201, 178)",a()};a()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFRN0csVUFDVmdHLEVBQWF6QixxQkFDWHdELEVBQ0EsYUFDQTNCLEVBR04sTUFFRTBCLEVBQU85RCxNQUFNQyxnQkFBa0IscUJBQy9CK0MsR0FDRixFQUdGQSxHQUFhLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXBzLy4vc3JjL2xvZ2ljL3NoaXAuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwcy8uL3NyYy9sb2dpYy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwcy8uL3NyYy9sb2dpYy9VSWNvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwcy8uL3NyYy9sb2dpYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXBzLy4vc3JjL2xvZ2ljL2NvbXB1dGVyUGxheWVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFNoaXAobGVuZ3RoKSB7XG4gIGxldCBfaGl0cyA9IDA7XG4gIGNvbnN0IF9sZW5ndGggPSBsZW5ndGg7XG4gIGNvbnN0IHBsYWNlZCA9IGZhbHNlO1xuICBsZXQgY29vcmRpbmF0ZXM7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIF9oaXRzICs9IDE7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4gX2hpdHMgPj0gX2xlbmd0aDtcblxuICAvLyAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuXG4gIC8vICAgdGhpcy5fc3VuayA9IGZhbHNlO1xuICAvLyAgIHRoaXMuX2hpdHMgPSAwO1xuXG4gIC8vICAgZnVuY3Rpb24gaGl0KCkge1xuICAvLyAgICAgdGhpcy5faGl0cyA9ICsxO1xuICAvLyAgICAgLy9cbiAgLy8gICB9XG5cbiAgLy8gICBmdW5jdGlvbiBpc1N1bmsoKSB7XG4gIC8vICAgICByZXR1cm4gdGhpcy5faGl0cyA+PSBsZW5ndGggPyB0cnVlIDogZmFsc2U7XG4gIC8vICAgICAvL1xuICAvLyAgIH1cblxuICByZXR1cm4geyBpc1N1bmssIGhpdCwgX2xlbmd0aCwgcGxhY2VkLCBjb29yZGluYXRlcyB9O1xufVxuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vc2hpcFwiO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBHYW1lYm9hcmQoKSB7XG4gIC8vIGVhY2ggbnVtYmVyIGNvcnJlc3BvbmRzIHRvIGluZGV4IG9mIGN1cnJlbnRTaGlwc09CSlxuICBjb25zdCBnYW1lQXJlbmEgPSBbXG4gICAgWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdLFxuICAgIFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXSxcbiAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdLFxuICAgIFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXSxcbiAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdLFxuICAgIFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXSxcbiAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdLFxuICBdO1xuXG4gIGNvbnN0IGN1cnJlbnRTaGlwc09CSiA9IFtcbiAgICBudWxsLFxuICAgIFNoaXAoNCksXG4gICAgU2hpcCgzKSxcbiAgICBTaGlwKDMpLFxuICAgIFNoaXAoMiksXG4gICAgU2hpcCgyKSxcbiAgICBTaGlwKDIpLFxuICAgIFNoaXAoMSksXG4gICAgU2hpcCgxKSxcbiAgICBTaGlwKDEpLFxuICAgIFNoaXAoMSksXG4gIF07XG5cbiAgY29uc3QgbmV3U2hpcEluZGV4ID0gKGxlbmd0aCkgPT4ge1xuICAgIGxldCBpbmRleDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAxMDsgaSsrKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIlRISVNcIiwgY3VycmVudFNoaXBzT0JKW2ldLl9sZW5ndGgpO1xuICAgICAgaWYgKGN1cnJlbnRTaGlwc09CSltpXSA9PSBudWxsKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICBjdXJyZW50U2hpcHNPQkpbaV0uX2xlbmd0aCA9PT0gbGVuZ3RoICYmXG4gICAgICAgIGN1cnJlbnRTaGlwc09CSltpXS5wbGFjZWQgPT09IGZhbHNlXG4gICAgICApIHtcbiAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGluZGV4O1xuICB9O1xuXG4gIGNvbnN0IF9wbGFjZWRTaGlwcyA9IFtdO1xuXG4gIGNvbnN0IHNoaXBOdW1iZXJSdWxlc1Bhc3NlZCA9IChsZW5ndGgpID0+IHtcbiAgICBjb25zdCBfYWxsb3dlZE9jY3VyYW5jZXMgPSB7XG4gICAgICAxOiA0LFxuICAgICAgMjogMyxcbiAgICAgIDM6IDIsXG4gICAgICA0OiAxLFxuICAgIH07XG4gICAgbGV0IGxlbmd0aE9jY2N1cmVkID0gMDtcbiAgICBjb25zdCBfb2NjdXJhbmNlcyA9ICh0YXJnZXRMZW5ndGgpID0+IHtcbiAgICAgIC8vIGxldCBjb3VudGVyID0gMDtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBfcGxhY2VkU2hpcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKF9wbGFjZWRTaGlwc1tpXSA9PT0gbGVuZ3RoKSB7XG4gICAgICAgICAgbGVuZ3RoT2NjY3VyZWQrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgX29jY3VyYW5jZXMoKTtcblxuICAgIGlmIChsZW5ndGhPY2NjdXJlZCA8IF9hbGxvd2VkT2NjdXJhbmNlc1tsZW5ndGhdKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgY29uc3QgZ2V0UmFuZG9tQ29vcmQgPSAoKSA9PiB7XG4gICAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIHJldHVybiBbeCwgeV07XG4gIH07XG5cbiAgY29uc3QgZ2V0VHJ1ZU9yRmFsc2UgPSAoKSA9PiB7XG4gICAgY29uc3QgbnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG4gICAgaWYgKG51bWJlciA9PT0gMSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXBSYW5kb21seSA9IChsZW5ndGgpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBnZXRSYW5kb21Db29yZCgpO1xuICAgIGNvbnN0IGhvcml6b250YWxseSA9IGdldFRydWVPckZhbHNlKCk7XG5cbiAgICB0cnkge1xuICAgICAgcGxhY2VTaGlwKGxlbmd0aCwgeCwgeSwgaG9yaXpvbnRhbGx5KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gcGxhY2VTaGlwUmFuZG9tbHkobGVuZ3RoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKGxlbmd0aCwgeCwgeSwgaG9yaXpvbnRhbGx5KSA9PiB7XG4gICAgLy8gdGVzdCB2YWxpZGl0eSBvZiBjby1vcmQgb3IgYW1vdW50IG9mIHNoaXBzXG4gICAgaWYgKHggPCAwIHx8IHkgPCAwIHx8IHggPiAxMCB8fCB5ID4gMTApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigoZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgIFwiY2FuJ3QgcGxhY2Ugc2hpcCBoZXJlIG9yIG5vIG1vcmUgb2YgdGhlc2Ugc2hpcHMgb3Igc2hpcCB0b28gYmlnXCJcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghc2hpcE51bWJlclJ1bGVzUGFzc2VkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoKGUpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcImNhbid0IHB1dCBhbnltb3JlIG9mIHRoZXNlIHNoaXBzXCIpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgbGV0IGNoZWNrZWRDb29yZDtcblxuICAgIGNvbnN0IGNoZWNrQ29vcmQgPSAoKSA9PiB7XG4gICAgICAvLyB3aGF0IHdvdWxkIHRoZXkgYmUgbmFpdmVseVxuXG4gICAgICBjb25zdCBuYWl2ZUNvb3IgPSAoKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcblxuICAgICAgICBpZiAoIWhvcml6b250YWxseSkge1xuICAgICAgICAgIGxldCBuZXdZID0geTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChbeCwgbmV3WV0pO1xuICAgICAgICAgICAgbmV3WSsrO1xuICAgICAgICAgICAgaWYgKG5ld1kgPiAxMCkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJib2F0IG91dCBvZiBnYW1lIVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoaG9yaXpvbnRhbGx5KSB7XG4gICAgICAgICAgbGV0IG5ld1ggPSB4O1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFtuZXdYLCB5XSk7XG4gICAgICAgICAgICBuZXdYKys7XG4gICAgICAgICAgICBpZiAobmV3WCA+IDEwKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkJvYXQgb3V0IG9mIGdhbWUhXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9KSgpO1xuXG4gICAgICBjb25zdCBjaGVja0Zvck92ZXJsYXAgPSAoKSA9PiB7XG4gICAgICAgIGxldCBhbGxvd2VkID0gdHJ1ZTtcblxuICAgICAgICBuYWl2ZUNvb3IuZm9yRWFjaCgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGFuWCA9IGNvb3JkaW5hdGVbMF07XG4gICAgICAgICAgY29uc3QgYW5ZID0gY29vcmRpbmF0ZVsxXTtcblxuICAgICAgICAgIC8vIGluIGdhbWVhcmVuYSBmaXJzdCBoYXZlIHRvIGFjY2VzcyBZXG4gICAgICAgICAgLy8gIFN3YXBwZWQgaGVyZVxuICAgICAgICAgIGlmIChnYW1lQXJlbmFbYW5ZXVthblhdICE9PSAwKSB7XG4gICAgICAgICAgICBhbGxvd2VkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gYWxsb3dlZDtcbiAgICAgIH07XG5cbiAgICAgIGlmIChjaGVja0Zvck92ZXJsYXAoKSkge1xuICAgICAgICBjaGVja2VkQ29vcmQgPSBbLi4ubmFpdmVDb29yXTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgLy8gY29uc29sZS5sb2coXCJUSElTXCIsIHNoaXBOdW1iZXJSdWxlc1Bhc3NlZChsZW5ndGgpKTtcbiAgICBpZiAoY2hlY2tDb29yZCgpICYmIHNoaXBOdW1iZXJSdWxlc1Bhc3NlZChsZW5ndGgpKSB7XG4gICAgICBjb25zdCBzaGlwT0JKSW5kZXggPSBuZXdTaGlwSW5kZXgobGVuZ3RoKTtcbiAgICAgIGN1cnJlbnRTaGlwc09CSltzaGlwT0JKSW5kZXhdLnBsYWNlZCA9IHRydWU7XG4gICAgICBfcGxhY2VkU2hpcHMucHVzaChsZW5ndGgpO1xuXG4gICAgICBjdXJyZW50U2hpcHNPQkpbc2hpcE9CSkluZGV4XS5jb29yZGluYXRlcyA9IGNoZWNrZWRDb29yZDtcbiAgICAgIGNoZWNrZWRDb29yZC5mb3JFYWNoKChhQ29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICBjb25zdCBuZXd4ID0gYUNvb3JkaW5hdGVbMF07XG4gICAgICAgIGNvbnN0IG5ld3kgPSBhQ29vcmRpbmF0ZVsxXTtcblxuICAgICAgICAvLyBzd2FwcGVkIGhlcmVcbiAgICAgICAgZ2FtZUFyZW5hW25ld3ldW25ld3hdID0gc2hpcE9CSkluZGV4O1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIm1vc3QgbGlrZWx5IHNoaXAgaXMgb3ZlcmxhcGluZ1wiKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gZ2V0IHBsYWNlbWVudCBpbmZvIG9mIHNoaXBzIHRoYXQgYXJlIGxlZ2FsIGFuZCBnZXQgYSBnYW1lYm9hcmQgdG8gcmVuZGVyIGEgcHJldmlld1xuXG4gIGNvbnN0IHBvc2l0aW9uQWxsU2hpcHNSYW5kb21seVRlbXBsYXRlID0gKCkgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuXG4gICAgY29uc3QgcG9zaXRpb25HYW1lQXJlbmEgPSBbXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgICBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0sXG4gICAgXTtcblxuICAgIGNvbnN0IGxlbmd0aHMgPSBbNCwgMywgMywgMiwgMiwgMiwgMSwgMSwgMSwgMV07XG5cbiAgICBsZXQgbGVuZ3Roc0luZGV4ID0gLTE7XG4gICAgY29uc3QgdHJ5UmFuZG9tUGxhY2VtZW50ID0gKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgW3gsIHldID0gZ2V0UmFuZG9tQ29vcmQoKTtcbiAgICAgICAgY29uc3QgaG9yaXpvbnRhbGx5ID0gZ2V0VHJ1ZU9yRmFsc2UoKTtcblxuICAgICAgICBsZW5ndGhzSW5kZXggKz0gMTtcblxuICAgICAgICBpZiAobGVuZ3Roc0luZGV4ID09PSAxMCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQucHVzaChcbiAgICAgICAgICAgIHBvc2l0aW9uU2hpcFJhbmRvbWx5KFxuICAgICAgICAgICAgICBwb3NpdGlvbkdhbWVBcmVuYSxcbiAgICAgICAgICAgICAgbGVuZ3Roc1tsZW5ndGhzSW5kZXhdLFxuICAgICAgICAgICAgICB4LFxuICAgICAgICAgICAgICB5LFxuICAgICAgICAgICAgICBob3Jpem9udGFsbHlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgcmV0dXJuIHRyeVJhbmRvbVBsYWNlbWVudCgpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsZW5ndGhzSW5kZXggLT0gMTtcbiAgICAgICAgcmV0dXJuIHRyeVJhbmRvbVBsYWNlbWVudCgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdHJ5UmFuZG9tUGxhY2VtZW50KCk7XG5cbiAgICByZXR1cm4gW3Jlc3VsdCwgcG9zaXRpb25HYW1lQXJlbmFdO1xuICB9O1xuXG4gIC8vIGZvciB0aGUgdGVtcGxhdGVcbiAgY29uc3QgcG9zaXRpb25TaGlwUmFuZG9tbHkgPSAoZmFrZUFyZW5hLCBsZW5ndGgsIHgsIHksIGhvcml6b250YWxseSkgPT4ge1xuICAgIC8vIHRlc3QgdmFsaWRpdHkgb2YgY28tb3JkIG9yIGFtb3VudCBvZiBzaGlwc1xuICAgIGlmICh4IDwgMCB8fCB5IDwgMCB8fCB4ID4gMTAgfHwgeSA+IDEwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoKGUpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBcImNhbid0IHBsYWNlIHNoaXAgaGVyZSBvciBubyBtb3JlIG9mIHRoZXNlIHNoaXBzIG9yIHNoaXAgdG9vIGJpZ1wiXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBsZXQgY2hlY2tlZENvb3JkO1xuXG4gICAgY29uc3QgY2hlY2tDb29yZCA9ICgpID0+IHtcbiAgICAgIC8vIHdoYXQgd291bGQgdGhleSBiZSBuYWl2ZWx5XG5cbiAgICAgIGNvbnN0IG5haXZlQ29vciA9ICgoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuXG4gICAgICAgIGlmICghaG9yaXpvbnRhbGx5KSB7XG4gICAgICAgICAgbGV0IG5ld1kgPSB5O1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFt4LCBuZXdZXSk7XG4gICAgICAgICAgICBuZXdZKys7XG4gICAgICAgICAgICBpZiAobmV3WSA+IDEwKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImJvYXQgb3V0IG9mIGdhbWUhXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChob3Jpem9udGFsbHkpIHtcbiAgICAgICAgICBsZXQgbmV3WCA9IHg7XG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goW25ld1gsIHldKTtcbiAgICAgICAgICAgIG5ld1grKztcbiAgICAgICAgICAgIGlmIChuZXdYID4gMTApIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQm9hdCBvdXQgb2YgZ2FtZSFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0pKCk7XG5cbiAgICAgIGNvbnN0IGNoZWNrRm9yT3ZlcmxhcCA9ICgpID0+IHtcbiAgICAgICAgbGV0IGFsbG93ZWQgPSB0cnVlO1xuXG4gICAgICAgIG5haXZlQ29vci5mb3JFYWNoKChjb29yZGluYXRlKSA9PiB7XG4gICAgICAgICAgY29uc3QgYW5YID0gY29vcmRpbmF0ZVswXTtcbiAgICAgICAgICBjb25zdCBhblkgPSBjb29yZGluYXRlWzFdO1xuXG4gICAgICAgICAgLy8gaW4gZ2FtZWFyZW5hIGZpcnN0IGhhdmUgdG8gYWNjZXNzIFlcblxuICAgICAgICAgIGlmIChmYWtlQXJlbmFbYW5ZXVthblhdICE9PSAwKSB7XG4gICAgICAgICAgICBhbGxvd2VkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gYWxsb3dlZDtcbiAgICAgIH07XG5cbiAgICAgIGlmIChjaGVja0Zvck92ZXJsYXAoKSkge1xuICAgICAgICBjaGVja2VkQ29vcmQgPSBbLi4ubmFpdmVDb29yXTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgLy8gY29uc29sZS5sb2coXCJUSElTXCIsIHNoaXBOdW1iZXJSdWxlc1Bhc3NlZChsZW5ndGgpKTtcbiAgICBpZiAoY2hlY2tDb29yZCgpKSB7XG4gICAgICAvLyBjb25zdCBzaGlwT0JKSW5kZXggPSBuZXdTaGlwSW5kZXgobGVuZ3RoKTtcbiAgICAgIC8vIGN1cnJlbnRTaGlwc09CSltzaGlwT0JKSW5kZXhdLnBsYWNlZCA9IHRydWU7XG4gICAgICAvLyBfcGxhY2VkU2hpcHMucHVzaChsZW5ndGgpO1xuXG4gICAgICAvLyBjdXJyZW50U2hpcHNPQkpbc2hpcE9CSkluZGV4XS5jb29yZGluYXRlcyA9IGNoZWNrZWRDb29yZDtcbiAgICAgIGNoZWNrZWRDb29yZC5mb3JFYWNoKChhQ29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICBjb25zdCBuZXd4ID0gYUNvb3JkaW5hdGVbMF07XG4gICAgICAgIGNvbnN0IG5ld3kgPSBhQ29vcmRpbmF0ZVsxXTtcblxuICAgICAgICBmYWtlQXJlbmFbbmV3eV1bbmV3eF0gPSAxO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiBjaGVja2VkQ29vcmRbMF1bMF0sXG4gICAgICAgIHk6IGNoZWNrZWRDb29yZFswXVsxXSxcbiAgICAgICAgbGVuZ3RoLFxuICAgICAgICBob3Jpem9udGFsbHksXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJtb3N0IGxpa2VseSBzaGlwIGlzIG92ZXJsYXBpbmdcIik7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IG1pc3NlZFNob3RzID0gW107XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9ICh4LCB5KSA9PiB7XG4gICAgaWYgKGdhbWVBcmVuYVt5XVt4XSAhPT0gMCkge1xuICAgICAgY29uc3Qgc2hpcE9CSkluZGV4ID0gZ2FtZUFyZW5hW3ldW3hdO1xuICAgICAgY3VycmVudFNoaXBzT0JKW3NoaXBPQkpJbmRleF0uaGl0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgbWlzc2VkU2hvdHMucHVzaChbeCwgeV0pO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCBhbGxTaGlwc1N1bmsgPSAoKSA9PiB7XG4gICAgbGV0IGNvdW50ZXIgPSAwO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgMTE7IGkrKykge1xuICAgICAgaWYgKGN1cnJlbnRTaGlwc09CSltpXS5pc1N1bmsoKSkge1xuICAgICAgICBjb3VudGVyKys7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjb3VudGVyID49IDEwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcGxhY2VTaGlwLFxuICAgIGdhbWVBcmVuYSxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGFsbFNoaXBzU3VuayxcbiAgICBtaXNzZWRTaG90cyxcbiAgICBjdXJyZW50U2hpcHNPQkosXG4gICAgcGxhY2VTaGlwUmFuZG9tbHksXG4gICAgcG9zaXRpb25BbGxTaGlwc1JhbmRvbWx5VGVtcGxhdGUsXG4gIH07XG59XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL2dhbWVib2FyZFwiO1xuXG5leHBvcnQgZGVmYXVsdCAoZnVuY3Rpb24gVUljb250cm9sbGVyKCkge1xuICBjb25zdCBnZXRCb3hET00gPSAoYXJlYSwgeCwgeSkgPT5cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHthcmVhfSAucm93W2RhdGEteT1cIiR7eX1cIl0gLmJveFtkYXRhLXg9XCIke3h9XCJdYCk7XG5cbiAgY29uc3QgcmVuZGVyRXhpc3RpbmdCb2F0cyA9IChnYW1lQXJlbmEsIHBsYXllckFyZWFET00pID0+IHtcbiAgICBjb25zdCB1cGRhdGVFYWNoRE9NQ29vcmRpbmF0ZSA9IChbeCwgeV0pID0+IHtcbiAgICAgIC8vIFRPRE86IGZpZ3VyZSBvdXQgd2h5IHRoZSBjb29yZGluYXRlcyBuZWVkIHRvIGJlIHN3YXBwZWQgaGVyZVxuICAgICAgZ2V0Qm94RE9NKHBsYXllckFyZWFET00sIHgsIHkpLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiZ3JleVwiO1xuICAgIH07XG5cbiAgICBnYW1lQXJlbmEuY3VycmVudFNoaXBzT0JKLmZvckVhY2goKGFTaGlwKSA9PiB7XG4gICAgICBpZiAoYVNoaXAgPT0gbnVsbCkge1xuICAgICAgICAvLyBudWxsXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiaGVyZVwiLCBhU2hpcCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhU2hpcC5jb29yZGluYXRlcy5mb3JFYWNoKHVwZGF0ZUVhY2hET01Db29yZGluYXRlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCByZXNldFRlbXBsYXRlQ29sb3VycyA9ICgpID0+IHtcbiAgICAvLyBsZXQgcG9zaXRpb25BcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3NpdGlvbkFyZWFcIilcblxuICAgIGNvbnN0IHVwZGF0ZUVhY2hET01Db29yZGluYXRlID0gKHgsIHkpID0+IHtcbiAgICAgIGdldEJveERPTShcInBvc2l0aW9uQXJlYVwiLCB4LCB5KS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIndoaXRlXCI7XG4gICAgfTtcblxuICAgIGZvciAobGV0IHggPSAwOyB4IDwgMTA7IHgrKykge1xuICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCAxMDsgeSsrKSB7XG4gICAgICAgIHVwZGF0ZUVhY2hET01Db29yZGluYXRlKHgsIHkpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCByZW5kZXJUZW1wbGF0ZUJvYXRzID0gKGdhbWVBcmVuYUNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgdXBkYXRlRWFjaERPTUNvb3JkaW5hdGUgPSAoeCwgeSkgPT4ge1xuICAgICAgZ2V0Qm94RE9NKFwicG9zaXRpb25BcmVhXCIsIHgsIHkpLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiZ3JleVwiO1xuICAgIH07XG5cbiAgICBnYW1lQXJlbmFDb29yZGluYXRlcy5mb3JFYWNoKChhUm93LCB5SW5kZXgpID0+IHtcbiAgICAgIGFSb3cuZm9yRWFjaCgoYVJvd0Nvb3JkLCB4SW5kZXgpID0+IHtcbiAgICAgICAgaWYgKGdhbWVBcmVuYUNvb3JkaW5hdGVzW3lJbmRleF1beEluZGV4XSA9PT0gMSkge1xuICAgICAgICAgIHVwZGF0ZUVhY2hET01Db29yZGluYXRlKHhJbmRleCwgeUluZGV4KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgY2hhbmdlQm94Q29sb3VyID0gKGFyZWEsIHgsIHksIGNvbG91cikgPT4ge1xuICAgIGNvbnN0IGhpdEJveERPTSA9IGdldEJveERPTShhcmVhLCB4LCB5KTtcbiAgICBoaXRCb3hET00uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3VyO1xuICB9O1xuXG4gIGNvbnN0IHRvZ2dsZUhvdmVyaW5nID0gKCkgPT4ge1xuICAgIGNvbnN0IGFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVuZW15QXJlYVwiKTtcbiAgICBhcmVhLmNsYXNzTGlzdC50b2dnbGUoXCJob3ZlcmluZ1wiKTtcbiAgfTtcblxuICBjb25zdCBnZXRCb3hET01zU2hpcEluZGV4ID0gKGdhbWVBcmVuYSwgeCwgeSkgPT4ge1xuICAgIGNvbnN0IHNoaXBJbmRleCA9IGdhbWVBcmVuYS5nYW1lQXJlbmFbeV1beF07XG4gICAgcmV0dXJuIHNoaXBJbmRleDtcbiAgfTtcblxuICBjb25zdCBjaGFuZ2VBbGxCb3hlc09mU2hpcCA9IChzaGlwSW5kZXgsIGFyZWFDbGFzcywgZ2FtZUFyZW5hKSA9PiB7XG4gICAgY29uc3QgeyBjb29yZGluYXRlcyB9ID0gZ2FtZUFyZW5hLmN1cnJlbnRTaGlwc09CSltzaGlwSW5kZXhdO1xuICAgIGNvb3JkaW5hdGVzLmZvckVhY2goKGFDb29yZCkgPT4ge1xuICAgICAgY29uc3QgW3NoaXBYLCBzaGlwWV0gPSBhQ29vcmQ7XG4gICAgICBnZXRCb3hET00oYCR7YXJlYUNsYXNzfWAsIHNoaXBYLCBzaGlwWSkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBzd2FwcGVkIGhlcmVcbiAgY29uc3QgZ2V0WGFuZFkgPSAoZSkgPT4ge1xuICAgIGNvbnN0IHsgeCB9ID0gZS50YXJnZXQuZGF0YXNldDtcbiAgICBjb25zdCB7IHkgfSA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuZGF0YXNldDtcblxuICAgIHJldHVybiBbeCwgeV07XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXJFeGlzdGluZ0JvYXRzLFxuICAgIGdldEJveERPTSxcbiAgICBnZXRYYW5kWSxcbiAgICBjaGFuZ2VBbGxCb3hlc09mU2hpcCxcbiAgICBnZXRCb3hET01zU2hpcEluZGV4LFxuICAgIGNoYW5nZUJveENvbG91cixcbiAgICB0b2dnbGVIb3ZlcmluZyxcbiAgICByZW5kZXJUZW1wbGF0ZUJvYXRzLFxuICAgIHJlc2V0VGVtcGxhdGVDb2xvdXJzLFxuICB9O1xufSkoKTtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vZ2FtZWJvYXJkXCI7XG5pbXBvcnQgVUljb250cm9sbGVyIGZyb20gXCIuL1VJY29udHJvbGxlclwiO1xuaW1wb3J0IGVuZW15UGxheWVyIGZyb20gXCIuL2NvbXB1dGVyUGxheWVyXCI7XG4vLyBpbXBvcnQgeyBjbGkgfSBmcm9tIFwid2VicGFja1wiO1xuLy8gaW1wb3J0IGVuZW15UGxheWVyIGZyb20gXCIuL2NvbXB1dGVyUGxheWVyXCI7XG5cbi8vIGNvbnN0IHRlc3QgPSBnZXRCb3hET00oXCJlbmVteUFyZWFcIiwgMCwgMCk7XG5cbmNvbnN0IHJhbmRvbWlzZUJUTiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcmFuZG9taXNlXCIpO1xuY29uc3Qgc3VibWl0UGxhY2VtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc3VibWl0XCIpO1xuY29uc3QgdGVtcGxhdGVEaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RlbXBsYXRlRGlhbG9nXCIpO1xuXG5sZXQgdGVtcGxhdGVQb3NpdGlvbnMgPSBbXTtcbmxldCB0ZW1wbGF0ZUFyZW5hO1xuXG5yYW5kb21pc2VCVE4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgVUljb250cm9sbGVyLnJlc2V0VGVtcGxhdGVDb2xvdXJzKCk7XG4gIGNvbnN0IHRlc3RHYW1lYm9hcmQgPSBHYW1lYm9hcmQoKTtcbiAgY29uc3QgW3Jlc3VsdCwgcG9zaXRpb25HYW1lQXJlbmFdID1cbiAgICB0ZXN0R2FtZWJvYXJkLnBvc2l0aW9uQWxsU2hpcHNSYW5kb21seVRlbXBsYXRlKCk7XG5cbiAgdGVtcGxhdGVBcmVuYSA9IHBvc2l0aW9uR2FtZUFyZW5hO1xuICB0ZW1wbGF0ZVBvc2l0aW9ucyA9IHJlc3VsdDtcbiAgLy8gY29uc29sZS5sb2coXCJ0aGUgcG9zaXRpb25zXCIsIHJlc3VsdCk7XG4gIC8vIGNvbnNvbGUudGFibGUocG9zaXRpb25HYW1lQXJlbmEpO1xuICBVSWNvbnRyb2xsZXIucmVuZGVyVGVtcGxhdGVCb2F0cyhwb3NpdGlvbkdhbWVBcmVuYSk7XG59KTtcblxuc3VibWl0UGxhY2VtZW50cy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICB0ZW1wbGF0ZURpYWxvZy5jbG9zZSgpO1xuXG4gIGdhbWVMb29wKHRlbXBsYXRlUG9zaXRpb25zKTtcbn0pO1xuXG5jb25zdCBnYW1lTG9vcCA9ICgpID0+IHtcbiAgY29uc3Qgc2V0VXBQbGFjZW1lbnRzID0gKGdhbWVib2FyZDEsIGdhbWVib2FyZDIpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIGdhbWVib2FyZDEucGxhY2VTaGlwKFxuICAgICAgICB0ZW1wbGF0ZVBvc2l0aW9uc1tpXS5sZW5ndGgsXG4gICAgICAgIHRlbXBsYXRlUG9zaXRpb25zW2ldLngsXG4gICAgICAgIHRlbXBsYXRlUG9zaXRpb25zW2ldLnksXG4gICAgICAgIHRlbXBsYXRlUG9zaXRpb25zW2ldLmhvcml6b250YWxseVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBnYW1lYm9hcmQyLnBsYWNlU2hpcFJhbmRvbWx5KDQpO1xuICAgIGdhbWVib2FyZDIucGxhY2VTaGlwUmFuZG9tbHkoMyk7XG4gICAgZ2FtZWJvYXJkMi5wbGFjZVNoaXBSYW5kb21seSgzKTtcbiAgICBnYW1lYm9hcmQyLnBsYWNlU2hpcFJhbmRvbWx5KDIpO1xuICAgIGdhbWVib2FyZDIucGxhY2VTaGlwUmFuZG9tbHkoMik7XG4gICAgZ2FtZWJvYXJkMi5wbGFjZVNoaXBSYW5kb21seSgyKTtcbiAgICBnYW1lYm9hcmQyLnBsYWNlU2hpcFJhbmRvbWx5KDEpO1xuICAgIGdhbWVib2FyZDIucGxhY2VTaGlwUmFuZG9tbHkoMSk7XG4gICAgZ2FtZWJvYXJkMi5wbGFjZVNoaXBSYW5kb21seSgxKTtcbiAgICBnYW1lYm9hcmQyLnBsYWNlU2hpcFJhbmRvbWx5KDEpO1xuICB9O1xuXG4gIGNvbnN0IHBsYXllckdhbWVib2FyZCA9IEdhbWVib2FyZCgpO1xuICBjb25zdCBlbmVteUdhbWVib2FyZCA9IEdhbWVib2FyZCgpO1xuICBzZXRVcFBsYWNlbWVudHMocGxheWVyR2FtZWJvYXJkLCBlbmVteUdhbWVib2FyZCk7XG4gIGxldCBnYW1lT0sgPSB0cnVlO1xuXG4gIFVJY29udHJvbGxlci5yZW5kZXJFeGlzdGluZ0JvYXRzKHBsYXllckdhbWVib2FyZCwgXCJwbGF5ZXJBcmVhXCIpO1xuICAvLyAgIFVJY29udHJvbGxlci5lbmVteUJveERPTUxpc3RlbmVyKGVuZW15R2FtZWJvYXJkKTtcbiAgLy8gICBjb25zb2xlLmxvZyhcImhhcHBlbnNcIik7XG5cbiAgY29uc3QgaGFuZGxlUGxheWVyQ2xpY2sgPSAoZSkgPT4ge1xuICAgIGNvbnN0IGJveERvbSA9IGUudGFyZ2V0O1xuICAgIC8vIGNvbnNvbGUubG9nKFwiYXR0ZW1wdFwiLCBlLnRhcmdldC5kYXRhc2V0KTtcbiAgICBjb25zdCBbeCwgeV0gPSBVSWNvbnRyb2xsZXIuZ2V0WGFuZFkoZSk7XG4gICAgY29uc3Qgc2hpcEluZGV4ID0gVUljb250cm9sbGVyLmdldEJveERPTXNTaGlwSW5kZXgoZW5lbXlHYW1lYm9hcmQsIHgsIHkpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiZXZhbHVhdGluZ1wiLCBib3hEb20uZGF0YXNldC5oaXQpO1xuXG4gICAgaWYgKCFib3hEb20uZGF0YXNldC5oaXQpIHtcbiAgICAgIGJveERvbS5kYXRhc2V0LmhpdCA9IHRydWU7XG4gICAgICBybXZFdmVudExpc3RlbmVyQW5kRW5lbXlUdXJuKCk7XG4gICAgICAvLyAgIGNvbnNvbGUubG9nKFwiYm9vbVwiKTtcbiAgICAgIGNvbnN0IGF0dGFja1Jlc3VsdCA9IGVuZW15R2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG4gICAgICAvLyAgIGNvbnNvbGUubG9nKFwiYXR0YWNrUmVzdWx0XCIsIGF0dGFja1Jlc3VsdCk7XG4gICAgICBpZiAoYXR0YWNrUmVzdWx0KSB7XG4gICAgICAgIGNvbnN0IHNoaXBPQkogPSBlbmVteUdhbWVib2FyZC5jdXJyZW50U2hpcHNPQkpbc2hpcEluZGV4XTtcbiAgICAgICAgYm94RG9tLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiZ3JleVwiO1xuXG4gICAgICAgIGlmIChzaGlwT0JKLmlzU3VuaygpKSB7XG4gICAgICAgICAgVUljb250cm9sbGVyLmNoYW5nZUFsbEJveGVzT2ZTaGlwKFxuICAgICAgICAgICAgc2hpcEluZGV4LFxuICAgICAgICAgICAgXCJlbmVteUFyZWFcIixcbiAgICAgICAgICAgIGVuZW15R2FtZWJvYXJkXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5lbXlHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgICBhbGVydChcImdhbWUgT3ZlclwiKTtcbiAgICAgICAgICBnYW1lT0sgPSBmYWxzZTtcbiAgICAgICAgICAvLyAgIHJlbW92aW5nRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYm94RG9tLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDIwMSwgMjAxLCAxNzgpXCI7XG4gICAgICAgIC8vIHJlbW92aW5nRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgIH1cbiAgICAgIGVuZW15VHVybigpO1xuICAgIH1cblxuICAgIC8vIGNvbnNvbGUubG9nKHNoaXBJbmRleCk7XG4gIH07XG5cbiAgY29uc3QgcGxheWVyc1R1cm4gPSAoKSA9PiB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLmVuZW15QXJlYSAucm93IC5ib3hgKS5mb3JFYWNoKChhQm94KSA9PiB7XG4gICAgICBhQm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVQbGF5ZXJDbGljaywgeyBvbmNlOiB0cnVlIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHJtdkV2ZW50TGlzdGVuZXJBbmRFbmVteVR1cm4gPSAoKSA9PiB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLmVuZW15QXJlYSAucm93IC5ib3hgKS5mb3JFYWNoKChhQm94KSA9PiB7XG4gICAgICBhQm94LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVQbGF5ZXJDbGljayk7XG4gICAgfSk7XG5cbiAgICBVSWNvbnRyb2xsZXIudG9nZ2xlSG92ZXJpbmcoKTtcbiAgfTtcblxuICBjb25zdCBlbmVteUJvdCA9IGVuZW15UGxheWVyKHBsYXllckdhbWVib2FyZCk7XG4gIGNvbnN0IGVuZW15VHVybiA9ICgpID0+IHtcbiAgICBpZiAoIWdhbWVPSykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyAgIGVuZW15J3MgdHVyblxuICAgIC8vICAgY29uc29sZS5sb2coZW5lbXlCb3QpO1xuICAgIGNvbnN0IFtpc0hpdCwgeCwgeV0gPSBlbmVteUJvdC5hdHRhY2soKTtcblxuICAgIGNvbnN0IGJveERPTSA9IFVJY29udHJvbGxlci5nZXRCb3hET00oXCJwbGF5ZXJBcmVhXCIsIHgsIHkpO1xuXG4gICAgaWYgKGlzSGl0KSB7XG4gICAgICBjb25zdCBlbmVteVNoaXBJbmRleCA9IFVJY29udHJvbGxlci5nZXRCb3hET01zU2hpcEluZGV4KFxuICAgICAgICBwbGF5ZXJHYW1lYm9hcmQsXG4gICAgICAgIHgsXG4gICAgICAgIHlcbiAgICAgICk7XG4gICAgICBjb25zdCBzaGlwT0JKID0gcGxheWVyR2FtZWJvYXJkLmN1cnJlbnRTaGlwc09CSltlbmVteVNoaXBJbmRleF07XG5cbiAgICAgIGJveERPTS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInBpbmtcIjtcbiAgICAgIHBsYXllcnNUdXJuKCk7XG4gICAgICBpZiAoc2hpcE9CSi5pc1N1bmsoKSkge1xuICAgICAgICBVSWNvbnRyb2xsZXIuY2hhbmdlQWxsQm94ZXNPZlNoaXAoXG4gICAgICAgICAgZW5lbXlTaGlwSW5kZXgsXG4gICAgICAgICAgXCJwbGF5ZXJBcmVhXCIsXG4gICAgICAgICAgcGxheWVyR2FtZWJvYXJkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vICAgY29uc29sZS5sb2coYm94RE9NKTtcbiAgICAgIGJveERPTS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJnYigyMDEsIDIwMSwgMTc4KVwiO1xuICAgICAgcGxheWVyc1R1cm4oKTtcbiAgICB9XG4gIH07XG5cbiAgcGxheWVyc1R1cm4oKTtcbn07XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBlbmVteVBsYXllcihodW1hbkJvYXJkKSB7XG4gIC8vIG1pbiBpcyBpbmNsdXNpdmUgbWF4IGlzIGV4Y2x1c2l2ZVxuXG4gIGNvbnN0IG1vdmVzRG9uZSA9IFtdO1xuICAvLyBjb25zb2xlLmxvZyhtb3Zlc0RvbmUpO1xuICBjb25zdCBnZXRSYW5kb21Db29yZCA9ICgpID0+IHtcbiAgICBjb25zdCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgY29uc3QgZm91bmRFbGVtZW50ID0gbW92ZXNEb25lLmZpbmQoXG4gICAgICAoZWxlbWVudCkgPT4gZWxlbWVudFswXSA9PT0geCAmJiBlbGVtZW50WzFdID09PSB5XG4gICAgKTtcblxuICAgIGlmIChmb3VuZEVsZW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGdldFJhbmRvbUNvb3JkKCk7XG4gICAgfVxuICAgIHJldHVybiBbeCwgeV07XG4gIH07XG5cbiAgY29uc3QgYXR0YWNrID0gKCkgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGdldFJhbmRvbUNvb3JkKCk7XG4gICAgLy8gY29uc29sZS5sb2coXCJyYW5kb20gY29vcmRcIiwgeCwgeSk7XG5cbiAgICBjb25zdCBpc0hpdCA9IGh1bWFuQm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcbiAgICBtb3Zlc0RvbmUucHVzaChbeCwgeV0pO1xuICAgIHJldHVybiBbaXNIaXQsIHgsIHldO1xuICB9O1xuXG4gIHJldHVybiB7IGF0dGFjayB9O1xufVxuIl0sIm5hbWVzIjpbIlNoaXAiLCJsZW5ndGgiLCJfaGl0cyIsIl9sZW5ndGgiLCJpc1N1bmsiLCJoaXQiLCJwbGFjZWQiLCJjb29yZGluYXRlcyIsIkdhbWVib2FyZCIsImdhbWVBcmVuYSIsImN1cnJlbnRTaGlwc09CSiIsIl9wbGFjZWRTaGlwcyIsInNoaXBOdW1iZXJSdWxlc1Bhc3NlZCIsImxlbmd0aE9jY2N1cmVkIiwidGFyZ2V0TGVuZ3RoIiwiaSIsIl9vY2N1cmFuY2VzIiwiZ2V0UmFuZG9tQ29vcmQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJnZXRUcnVlT3JGYWxzZSIsInBsYWNlU2hpcFJhbmRvbWx5IiwieCIsInkiLCJob3Jpem9udGFsbHkiLCJwbGFjZVNoaXAiLCJlIiwiRXJyb3IiLCJjb25zb2xlIiwiZXJyb3IiLCJjaGVja2VkQ29vcmQiLCJuYWl2ZUNvb3IiLCJyZXN1bHQiLCJuZXdYIiwicHVzaCIsIm5ld1kiLCJhbGxvd2VkIiwiZm9yRWFjaCIsImNvb3JkaW5hdGUiLCJhblgiLCJhblkiLCJjaGVja0Zvck92ZXJsYXAiLCJjaGVja0Nvb3JkIiwic2hpcE9CSkluZGV4IiwiaW5kZXgiLCJuZXdTaGlwSW5kZXgiLCJhQ29vcmRpbmF0ZSIsIm5ld3giLCJuZXd5IiwibWlzc2VkU2hvdHMiLCJyZWNlaXZlQXR0YWNrIiwiYWxsU2hpcHNTdW5rIiwiY291bnRlciIsInBvc2l0aW9uQWxsU2hpcHNSYW5kb21seVRlbXBsYXRlIiwicG9zaXRpb25HYW1lQXJlbmEiLCJsZW5ndGhzIiwibGVuZ3Roc0luZGV4IiwidHJ5UmFuZG9tUGxhY2VtZW50IiwiZmFrZUFyZW5hIiwicG9zaXRpb25TaGlwUmFuZG9tbHkiLCJnZXRCb3hET00iLCJhcmVhIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicmVuZGVyRXhpc3RpbmdCb2F0cyIsInBsYXllckFyZWFET00iLCJ1cGRhdGVFYWNoRE9NQ29vcmRpbmF0ZSIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwiYVNoaXAiLCJnZXRYYW5kWSIsInRhcmdldCIsImRhdGFzZXQiLCJwYXJlbnRFbGVtZW50IiwiY2hhbmdlQWxsQm94ZXNPZlNoaXAiLCJzaGlwSW5kZXgiLCJhcmVhQ2xhc3MiLCJhQ29vcmQiLCJzaGlwWCIsInNoaXBZIiwiZ2V0Qm94RE9Nc1NoaXBJbmRleCIsImNoYW5nZUJveENvbG91ciIsImNvbG91ciIsInRvZ2dsZUhvdmVyaW5nIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwicmVuZGVyVGVtcGxhdGVCb2F0cyIsImdhbWVBcmVuYUNvb3JkaW5hdGVzIiwiYVJvdyIsInlJbmRleCIsImFSb3dDb29yZCIsInhJbmRleCIsInJlc2V0VGVtcGxhdGVDb2xvdXJzIiwicmFuZG9taXNlQlROIiwic3VibWl0UGxhY2VtZW50cyIsInRlbXBsYXRlRGlhbG9nIiwidGVtcGxhdGVBcmVuYSIsInRlbXBsYXRlUG9zaXRpb25zIiwiYWRkRXZlbnRMaXN0ZW5lciIsIlVJY29udHJvbGxlciIsInRlc3RHYW1lYm9hcmQiLCJjbG9zZSIsImdhbWVMb29wIiwicGxheWVyR2FtZWJvYXJkIiwiZW5lbXlHYW1lYm9hcmQiLCJnYW1lYm9hcmQxIiwiZ2FtZWJvYXJkMiIsInNldFVwUGxhY2VtZW50cyIsImdhbWVPSyIsImhhbmRsZVBsYXllckNsaWNrIiwiYm94RG9tIiwicm12RXZlbnRMaXN0ZW5lckFuZEVuZW15VHVybiIsInNoaXBPQkoiLCJhbGVydCIsImVuZW15VHVybiIsInBsYXllcnNUdXJuIiwicXVlcnlTZWxlY3RvckFsbCIsImFCb3giLCJvbmNlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImVuZW15Qm90IiwiaHVtYW5Cb2FyZCIsIm1vdmVzRG9uZSIsInVuZGVmaW5lZCIsImZpbmQiLCJlbGVtZW50IiwiYXR0YWNrIiwiaXNIaXQiLCJlbmVteVBsYXllciIsImJveERPTSIsImVuZW15U2hpcEluZGV4Il0sInNvdXJjZVJvb3QiOiIifQ==